<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <div class="app-container">
        <%- include('../partials/sidebar') %>

        <main class="main-content">
            <%- include('../partials/topbar') %>

            <div class="page-content">
                <div class="page-header">
                    <div class="page-header-content">
                        <h1>Schedule</h1>
                        <p>View and manage your study schedule</p>
                    </div>
                </div>

                <!-- Week Navigation -->
                <div class="schedule-nav">
                    <button class="btn btn-ghost" id="prevWeek">
                        <i data-lucide="chevron-left"></i>
                        Previous
                    </button>
                    <h3 id="weekLabel">This Week</h3>
                    <button class="btn btn-ghost" id="nextWeek">
                        Next
                        <i data-lucide="chevron-right"></i>
                    </button>
                </div>

                <!-- Calendar View -->
                <div class="schedule-grid">
                    <% const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']; %>
                    <% days.forEach((day, index) => { %>
                        <div class="schedule-day">
                            <div class="day-header">
                                <span class="day-name"><%= day %></span>
                                <span class="day-date" id="date-<%= index %>"></span>
                            </div>
                            <div class="day-tasks" id="tasks-<%= index %>">
                                <div class="empty-day">
                                    <i data-lucide="calendar-off"></i>
                                    <p>No tasks</p>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <!-- Upcoming Deadlines -->
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div class="card-header">
                        <h3>
                            <i data-lucide="alert-triangle"></i>
                            Upcoming Deadlines
                        </h3>
                        <a href="/tasks" class="btn btn-ghost btn-sm">View All Tasks</a>
                    </div>
                    <div class="card-body">
                        <% if (upcomingTasks.length === 0) { %>
                            <div class="empty-state">
                                <i data-lucide="check-circle"></i>
                                <h4>All caught up!</h4>
                                <p>You have no upcoming deadlines</p>
                            </div>
                        <% } else { %>
                            <div class="deadline-list">
                                <% upcomingTasks.forEach(task => { 
                                    const daysLeft = Math.ceil((new Date(task.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                                    const urgency = daysLeft <= 1 ? 'urgent' : daysLeft <= 3 ? 'warning' : 'normal';
                                %>
                                    <div class="deadline-item <%= urgency %>">
                                        <div class="deadline-indicator" style="background: <%= task.subject_color %>"></div>
                                        <div class="deadline-info">
                                            <a href="/tasks/<%= task.id %>" class="deadline-title"><%= task.title %></a>
                                            <span class="deadline-subject"><%= task.subject_name %></span>
                                        </div>
                                        <div class="deadline-date">
                                            <% if (daysLeft < 0) { %>
                                                <span class="overdue"><%= Math.abs(daysLeft) %> days overdue</span>
                                            <% } else if (daysLeft === 0) { %>
                                                <span class="due-today">Due today</span>
                                            <% } else if (daysLeft === 1) { %>
                                                <span class="due-tomorrow">Due tomorrow</span>
                                            <% } else { %>
                                                <span><%= daysLeft %> days left</span>
                                            <% } %>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        lucide.createIcons();

        // Menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.querySelector('.sidebar');
        if (menuToggle) {
            menuToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
        }
    </script>

    <style>
        .schedule-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
        }

        .schedule-nav h3 {
            margin: 0;
            font-weight: 600;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--spacing-md);
        }

        .schedule-day {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            overflow: hidden;
            min-height: 200px;
        }

        .day-header {
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .day-name {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .day-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .day-tasks {
            padding: var(--spacing-sm);
            min-height: 150px;
        }

        .empty-day {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-tertiary);
            font-size: 0.75rem;
        }

        .empty-day svg {
            width: 20px;
            height: 20px;
            margin-bottom: var(--spacing-xs);
        }

        .deadline-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .deadline-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
        }

        .deadline-item.urgent {
            background: #fef2f2;
            border: 1px solid #fecaca;
        }

        .deadline-item.warning {
            background: #fffbeb;
            border: 1px solid #fde68a;
        }

        .deadline-indicator {
            width: 4px;
            height: 40px;
            border-radius: 2px;
        }

        .deadline-info {
            flex: 1;
        }

        .deadline-title {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            text-decoration: none;
        }

        .deadline-title:hover {
            color: var(--primary);
        }

        .deadline-subject {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .deadline-date {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .deadline-date .overdue {
            color: var(--danger);
        }

        .deadline-date .due-today {
            color: var(--danger);
            font-weight: 600;
        }

        .deadline-date .due-tomorrow {
            color: var(--warning);
        }

        @media (max-width: 1024px) {
            .schedule-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .schedule-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
