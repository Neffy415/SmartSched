<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <div class="app-container">
        <%- include('../partials/sidebar') %>

        <main class="main-content">
            <%- include('../partials/topbar') %>

            <div class="page-content">
                <% if (typeof success_msg !== 'undefined' && success_msg.length > 0) { %>
                    <div class="alert alert-success animate-fade-in">
                        <i data-lucide="check-circle"></i>
                        <p><%= success_msg %></p>
                    </div>
                <% } %>

                <% if (typeof error_msg !== 'undefined' && error_msg.length > 0) { %>
                    <div class="alert alert-error animate-fade-in">
                        <i data-lucide="alert-circle"></i>
                        <p><%= error_msg %></p>
                    </div>
                <% } %>

                <div class="page-header">
                    <div class="page-header-content">
                        <h1>Settings</h1>
                        <p>Manage your account and preferences</p>
                    </div>
                </div>

                <div class="settings-grid">
                    <!-- Profile Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3>
                                <i data-lucide="user"></i>
                                Profile Settings
                            </h3>
                        </div>
                        <div class="card-body">
                            <form action="/settings/profile" method="POST" class="form">
                                <div class="form-group">
                                    <label for="fullName">Full Name</label>
                                    <input type="text" id="fullName" name="fullName" 
                                           value="<%= user.fullName || '' %>" 
                                           class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email Address</label>
                                    <input type="email" id="email" name="email" 
                                           value="<%= user.email %>" 
                                           class="form-control" required>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i data-lucide="save"></i>
                                    Save Changes
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Change Password -->
                    <div class="card">
                        <div class="card-header">
                            <h3>
                                <i data-lucide="lock"></i>
                                Change Password
                            </h3>
                        </div>
                        <div class="card-body">
                            <form action="/settings/password" method="POST" class="form">
                                <div class="form-group">
                                    <label for="currentPassword">Current Password</label>
                                    <input type="password" id="currentPassword" name="currentPassword" 
                                           class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">New Password</label>
                                    <input type="password" id="newPassword" name="newPassword" 
                                           class="form-control" required minlength="6">
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">Confirm New Password</label>
                                    <input type="password" id="confirmPassword" name="confirmPassword" 
                                           class="form-control" required minlength="6">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i data-lucide="key"></i>
                                    Update Password
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Study Preferences -->
                    <div class="card">
                        <div class="card-header">
                            <h3>
                                <i data-lucide="clock"></i>
                                Study Preferences
                            </h3>
                        </div>
                        <div class="card-body">
                            <form action="/settings/preferences" method="POST" class="form">
                                <div class="form-group">
                                    <label for="dailyGoal">Daily Study Goal (hours)</label>
                                    <input type="number" id="dailyGoal" name="dailyGoal" 
                                           value="<%= preferences?.dailyGoal || 4 %>" 
                                           class="form-control" min="1" max="12">
                                </div>
                                <div class="form-group">
                                    <label for="sessionDuration">Default Session Duration (minutes)</label>
                                    <select id="sessionDuration" name="sessionDuration" class="form-control">
                                        <option value="25" <%= preferences?.sessionDuration === 25 ? 'selected' : '' %>>25 min (Pomodoro)</option>
                                        <option value="45" <%= preferences?.sessionDuration === 45 ? 'selected' : '' %>>45 min</option>
                                        <option value="60" <%= !preferences?.sessionDuration || preferences?.sessionDuration === 60 ? 'selected' : '' %>>60 min</option>
                                        <option value="90" <%= preferences?.sessionDuration === 90 ? 'selected' : '' %>>90 min</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="breakDuration">Break Duration (minutes)</label>
                                    <input type="number" id="breakDuration" name="breakDuration" 
                                           value="<%= preferences?.breakDuration || 10 %>" 
                                           class="form-control" min="5" max="30">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i data-lucide="save"></i>
                                    Save Preferences
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Danger Zone -->
                    <div class="card danger-card">
                        <div class="card-header">
                            <h3>
                                <i data-lucide="alert-triangle"></i>
                                Danger Zone
                            </h3>
                        </div>
                        <div class="card-body">
                            <p class="text-secondary">These actions cannot be undone. Please be careful.</p>
                            
                            <div class="danger-actions">
                                <div class="danger-action">
                                    <div>
                                        <h4>Clear All Data</h4>
                                        <p>Delete all your subjects, tasks, and study sessions</p>
                                    </div>
                                    <button type="button" class="btn btn-outline-danger" 
                                            onclick="if(confirm('Are you sure? This will delete ALL your data!')) document.getElementById('clearDataForm').submit()">
                                        <i data-lucide="trash-2"></i>
                                        Clear Data
                                    </button>
                                    <form id="clearDataForm" action="/settings/clear-data" method="POST" style="display:none;"></form>
                                </div>
                                
                                <div class="danger-action">
                                    <div>
                                        <h4>Delete Account</h4>
                                        <p>Permanently delete your account and all data</p>
                                    </div>
                                    <button type="button" class="btn btn-danger" 
                                            onclick="if(confirm('Are you sure you want to delete your account? This cannot be undone!')) document.getElementById('deleteAccountForm').submit()">
                                        <i data-lucide="user-x"></i>
                                        Delete Account
                                    </button>
                                    <form id="deleteAccountForm" action="/settings/delete-account" method="POST" style="display:none;"></form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        lucide.createIcons();

        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.querySelector('.sidebar');
        if (menuToggle) {
            menuToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
        }
    </script>

    <style>
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-xl);
        }

        .danger-card {
            border-color: var(--danger);
        }

        .danger-card .card-header h3 {
            color: var(--danger);
        }

        .danger-actions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }

        .danger-action {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            background: #fef2f2;
            border-radius: var(--radius-lg);
        }

        .danger-action h4 {
            margin: 0 0 0.25rem 0;
            font-size: 0.875rem;
        }

        .danger-action p {
            margin: 0;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .btn-outline-danger {
            color: var(--danger);
            border: 1px solid var(--danger);
            background: transparent;
        }

        .btn-outline-danger:hover {
            background: var(--danger);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
